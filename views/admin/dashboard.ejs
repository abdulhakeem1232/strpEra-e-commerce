<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Breeze Admin</title>
    <link rel="stylesheet" href="/admin_assets/assets/vendors/mdi/css/materialdesignicons.min.css" />
    <link rel="stylesheet" href="/admin_assets/assets/vendors/flag-icon-css/css/flag-icon.min.css" />
    <link rel="stylesheet" href="/admin_assets/assets/vendors/css/vendor.bundle.base.css" />
    <link rel="stylesheet" href="/admin_assets/assets/vendors/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/admin_assets/assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css" />
    <link rel="stylesheet" href="/admin_assets/assets/css/style.css" />
    <link rel="shortcut icon" href="/admin_assets/assets/images/favicon.png" />
  </head>
  <body>
    <div class="container-scroller">
      <%- include('partials/sidebar')%>
      <div class="container-fluid page-body-wrapper">
        <div id="theme-settings" class="settings-panel">
          <i class="settings-close mdi mdi-close"></i>
          <p class="settings-heading">SIDEBAR SKINS</p>
          <div class="sidebar-bg-options selected" id="sidebar-default-theme">
            <div class="img-ss rounded-circle bg-light border mr-3"></div> Default
          </div>
          <div class="sidebar-bg-options" id="sidebar-dark-theme">
            <div class="img-ss rounded-circle bg-dark border mr-3"></div> Dark
          </div>
          <p class="settings-heading mt-2">HEADER SKINS</p>
          <div class="color-tiles mx-0 px-4">
            <div class="tiles light"></div>
            <div class="tiles dark"></div>
          </div>
        </div>
        <%- include('partials/nav')%>
        <div class="main-panel">
          <div class="content-wrapper pb-0">
            <!-- <div class="page-header flex-wrap">
              <h3 class="mb-0"> Hi, welcome back! <span class="pl-0 h6 pl-sm-2 text-muted d-inline-block">Your web analytics dashboard template.</span>
              </h3>
              <div class="d-flex">
                <button type="button" class="btn btn-sm bg-white btn-icon-text border">
                  <i class="mdi mdi-email btn-icon-prepend"></i> Email </button>
                <button type="button" class="btn btn-sm bg-white btn-icon-text border ml-3">
                  <i class="mdi mdi-printer btn-icon-prepend"></i> Print </button>
                <button type="button" class="btn btn-sm ml-3 btn-success"> Add User </button>
              </div>
            </div> -->
            <div class="row">
              <div class="col-xl-3 col-lg-12 stretch-card grid-margin">
                <div class="row">
                  <div class="col-xl-12 col-md-6 stretch-card grid-margin grid-margin-sm-0 pb-sm-3">
                    <div class="card bg-warning">
                      <div class="card-body px-3 py-4">
                        <div class="d-flex justify-content-between align-items-start">
                          <div class="color-card">
                            <p class="mb-0 color-card-head">Total Revenue</p>
                            <h2 class="text-white">₹<%= revenue[0].total %>
                            </h2>
                          </div>
                          <i class="card-icon-indicator mdi mdi-basket bg-inverse-icon-warning"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-12 col-md-6 stretch-card grid-margin grid-margin-sm-0 pb-sm-3">
                    <div class="card bg-danger">
                      <div class="card-body px-3 py-4">
                        <div class="d-flex justify-content-between align-items-start">
                          <div class="color-card">
                            <p class="mb-0 color-card-head">Products</p>
                            <h2 class="text-white"> <%= pro %>
                            </h2>
                          </div>
                          <i class="card-icon-indicator mdi mdi-cube-outline bg-inverse-icon-danger"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-12 col-md-6 stretch-card grid-margin grid-margin-sm-0 pb-sm-3 pb-lg-0 pb-xl-3">
                    <div class="card bg-primary">
                      <div class="card-body px-3 py-4">
                        <div class="d-flex justify-content-between align-items-start">
                          <div class="color-card">
                            <p class="mb-0 color-card-head">Orders</p>
                            <h2 class="text-white"> <%= orders %>
                            </h2>
                          </div>
                          <i class="card-icon-indicator mdi mdi-briefcase-outline bg-inverse-icon-primary"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-12 col-md-6 stretch-card pb-sm-3 pb-lg-0">
                    <div class="card bg-success">
                      <div class="card-body px-3 py-4">
                        <div class="d-flex justify-content-between align-items-start">
                          <div class="color-card">
                            <p class="mb-0 color-card-head">Users</p>
                            <h2 class="text-white"><%= users %></h2>
                          </div>
                          <i class="card-icon-indicator mdi mdi-account-circle bg-inverse-icon-success"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-9 stretch-card grid-margin">
                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-sm-7">
                        <h5>Business Survey</h5>
                        <p class="text-muted"><a class="text-muted font-weight-medium pl-2" href="#"><u></u></a>
                        </p>
                      </div>
                      <div class="col-sm-5 text-md-right">
                        <form action="/admin/downloadsales" method="post">
                          <input type="date" id="startDate" placeholder="Star tDate" name="startDate" required>
                          <input type="date" id="endDate" placeholder="End Date" name="endDate" required>
                          <button type="submit" class="btn btn-icon-text mb-3 mt-2 mb-sm-0 btn-inverse-primary font-weight-normal">
                              <i class="mdi mdi-email btn-icon-prepend"></i>Download Report
                          </button>
                      </form>
                      
                      </div>
                    </div>
                   
                    <div class="row my-3">
                      <div class="col-sm-12">
                        <div class="flot-chart-wrapper">
                          <label for="selectType">Select Type:</label>
                          <select id="selectType" onchange="updateChart(this)">
                            <option value="" disabled selected>Select</option>
                            <option value="month">Monthly</option>
                            <option value="year">Yearly</option>
                          </select>
                          <div id="flotChart" class="flot-chart">


                            <canvas  id="chart"></canvas>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row my-3">
                      <div class="col-sm-12">
                        <div class="flot-chart-wrapper">
                          <div id="flotChart" class="flot-chart">
                            <canvas id="chart2"></canvas>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <!-- <div class="col-sm-8">
                        <p class="text-muted mb-0">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore. <b>Learn More</b>
                        </p>
                      </div> -->
                      <div class="col-sm-4">
                        <p class="mb-0 text-muted">Sales Revenue</p>
                        <h5 class="d-inline-block survey-value mb-0"> ₹<%= revenue[0].total %> </h5>
                        <p class="d-inline-block text-danger mb-0">  </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
           
           
           
          </div>
  
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js --> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      function getMonthName(month) {
        const monthNames = [
          "Jan", "Feb", "Mar", "Apr", "May", "Jun",
          "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
        ];
        return monthNames[month - 1];
      }
    
      async function updateChart(select) {
        const selected = select.value;
        console.log(selected);
        const response = await fetch(`/admin/chartData`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            selected: selected
          })
        });
        const data = await response.json();
        chart(data, selected);
      }
    
      function chart(data, selected) {
        console.log("hghhgh", data);
        data.sales.sort((a, b) => (a._id.month || a._id.year) - (b._id.month || b._id.year));
        data.order.sort((a, b) => (a._id.month || a._id.year) - (b._id.month || b._id.year));
    
        if (window.stackedBar) {
          window.stackedBar.destroy();
        }
        if (window.stackedBar2) {
          window.stackedBar2.destroy();
        }
    
        var ctl = document.getElementById('chart');
        window.stackedBar = new Chart(ctl, {
          type: 'line',
          data: {
            labels: data.sales.map(entry => selected == 'month' ? getMonthName(entry._id.month) : entry._id.year),
            datasets: [{
              label: 'Sales Report',
              backgroundColor: 'rgb(255,99,132)',
              borderColor: 'rgb(255,99,132)',
              data: data.sales.map(entry => entry.totalAmount)
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
    
        var ctl2 = document.getElementById('chart2');
        window.stackedBar2 = new Chart(ctl2, {
          type: 'line',
          data: {
            labels: data.order.map(entry => selected == 'month' ? getMonthName(entry._id.month) : entry._id.year),
            datasets: [{
              label: 'Order Report',
              backgroundColor: 'blue',
              borderColor: 'blue',
              data: data.order.map(entry => entry.count)
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      }
    </script>
    
    <script src="/admin_assets/assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <!-- <script src="/admin_assets/assets/vendors/chart.js/Chart.min.js"></script> -->
    <script src="/admin_assets/assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <script src="/admin_assets/assets/vendors/flot/jquery.flot.js"></script>
    <script src="/admin_assets/assets/vendors/flot/jquery.flot.resize.js"></script>
    <script src="/admin_assets/assets/vendors/flot/jquery.flot.categories.js"></script>
    <script src="/admin_assets/assets/vendors/flot/jquery.flot.fillbetween.js"></script>
    <script src="assets/vendors/flot/jquery.flot.stack.js"></script>
    <script src="/admin_assets/assets/vendors/flot/jquery.flot.pie.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="/admin_assets/assets/js/off-canvas.js"></script>
    <script src="/admin_assets/assets/js/hoverable-collapse.js"></script>
    <script src="/admin_assets/assets/js/misc.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="/admin_assets/assets/js/dashboard.js"></script>
    <!-- End custom js for this page -->
  </body>
</html>