<!DOCTYPE html>
<html lang="zxx" class="no-js">

<head>
	<!-- Mobile Specific Meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Favicon-->
	<link rel="shortcut icon" href="img/fav.png">
	<!-- Author Meta -->
	<meta name="author" content="CodePixar">
	<!-- Meta Description -->
	<meta name="description" content="">
	<!-- Meta Keyword -->
	<meta name="keywords" content="">
	<!-- meta character set -->
	<meta charset="UTF-8">
	<!-- Site Title -->
	<title>UrbanSole</title>
	<!--
		CSS
		============================================= -->
        <link rel="stylesheet" href="/css/linearicons.css">
        <link rel="stylesheet" href="/css/font-awesome.min.css">
        <link rel="stylesheet" href="/css/themify-icons.css">
        <link rel="stylesheet" href="/css/bootstrap.css">
        <link rel="stylesheet" href="/css/owl.carousel.css">
        <link rel="stylesheet" href="/css/nice-select.css">
        <link rel="stylesheet" href="/css/nouislider.min.css">
        <link rel="stylesheet" href="/css/ion.rangeSlider.css" />
        <link rel="stylesheet" href="/css/ion.rangeSlider.skinFlat.css" />
        <link rel="stylesheet" href="/css/magnific-popup.css">
        <link rel="stylesheet" href="/css/main.css">
		<link rel="stylesheet" href="/admin_assets/assets/css/magiczoom.css">
        <script src="/admin_assets/assets/js/magiczoom.js"></script>
     
</head>


<body>
    <%- include('partials/nav')%>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

<body>
    <section class="banner-area organic-breadcrumb">
        <div class="container">
            <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
                <div class="col-first">
                    <h1>Shopping</h1>
                    <nav class="d-flex align-items-center">
                        <a href="#">Home<span class="lnr lnr-arrow-right"></span></a>
                        <a href="#">Wallet History</a>
                    </nav>
                </div>
            </div>
        </div>
    </section>
<div class="container mt-5 ">
    <h1 class="mb-4 text-center">Wallet History</h1>
    <h4>Balance: <%= user.wallet %></h4>
    <form id="Form">
        <input type="number" id="Amount" name="Amount" placeholder="Enter Amount">
        <button onclick="RazorpayWallet(event)">Add To Wallet</button>
      </form>
    <% if(wallet && wallet.history.length > 0) { %>
        <div class="row">
            <% wallet.history.forEach((entry, index) => { %>
                <div class="<%= wallet.history.length === 1 ? 'offset-md-3 col-md-6' : 'col-md-6' %> mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title" style='color:<%= entry.transaction === "Credited" ? "green" : "red"; %>'>

                                <%= entry.transaction %></h5>
                            <p class="card-text">Amount: <%= entry.amount %></p>
                            <p class="card-text">Date: <%= new Date(entry.date).toLocaleString() %></p>
                        </div>
                    </div>
                </div>

                <% if((index + 1) % 2 === 0) { %>
                    </div>
                    <div class="row">
                <% } %>
            <% }); %>
        </div>
    <% } else { %>
        <p>No history available.</p>
    <% } %>
</div>
<%- include('partials/footer')%>
<!-- Include Bootstrap JS (optional) -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>  
<script>
    async function  RazorpayWallet()
	{
    event.preventDefault()
    console.log("ivide function");
		let amountToPay=document.getElementById('Amount').value
    console.log(amountToPay);
		if(!amountToPay){
			Swal.fire({
    text: 'please enter an amount',
    icon: 'error',
  confirmButtonText: 'OK',
  customClass: {
    title: 'text-danger',
    popup: 'swal2-popup-custom',
    confirmButton: 'btn btn-danger'
  },
  showCancelButton: false,
  showCloseButton: true,
  showLoaderOnConfirm: false,
  timer: 3000 
});

		}
		
		
		
		else {
console.log("upi total","ppppppp");

var options = {
"key": 'rzp_test_FJ1rRuVkxPiUu9', 
"amount":  amountToPay*100, 
"currency": "INR",
"name": "UrbanSole",
"description": "Test Transaction",
"image": "Urban Sole",
"order_id": orderId, 
"handler": function (response){
alert(response.razorpay_payment_id);
document.getElementById('Form').action = '/walletTopup';
document.getElementById('Form').method = 'post'; 

document.getElementById('Form').submit();

},


"theme": {
"color": "orange"
},
};
var rzp1 = new Razorpay(options);
rzp1.on('payment.failed', function (response){
        alert(response.error.code);
        alert(response.error.description);
        alert(response.error.source);
        alert(response.error.step);
        alert(response.error.reason);
        alert(response.error.metadata.order_id);
        alert(response.error.metadata.payment_id);
});
    rzp1.open();


    e.preventDefault();


                var orderId ;
$(document).ready(function(){
    var settings = {
  "url": "/walletcreate/orderId",
  "method": "POST",
  "timeout": 0,
  "headers": {
    "Content-Type": "application/json"
  },
  "data": JSON.stringify({
    "amount": amountToPay*100
  }),
};


$.ajax(settings).done(function (response) {

  orderId=response.orderId;
  console.log(orderId);
  $("button").show();
});
});

            }
		
		}

  </script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.9/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="/public/user_assets/js/vendor/jquery-2.2.4.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
            integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
            crossorigin="anonymous"></script>
        <script src="/public/user_assets/js/vendor/bootstrap.min.js"></script>
        <script src="/public/user_assets/js/jquery.ajaxchimp.min.js"></script>
        <script src="/public/user_assets/js/jquery.nice-select.min.js"></script>
        <script src="/public/user_assets/js/jquery.sticky.js"></script>
        <script src="/public/user_assets/js/nouislider.min.js"></script>
        <script src="/public/user_assets/js/countdown.js"></script>
        <script src="/public/user_assets/js/jquery.magnific-popup.min.js"></script>
        <script src="/public/user_assets/js/owl.carousel.min.js"></script>
        <!--gmaps Js-->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
        <script src="/public/user_assets/js/gmaps.min.js"></script>
        <script src="/public/user_assets/js/main.js"></script>


